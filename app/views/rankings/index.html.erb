<div class="container">
  <div class="row mt-3">
    <div class="col"></div>
    <div class="col">
      <div class="mb-3">
        <%= search_form_for @search do |f| %>
        <%= f.label :title_cont, "ランキングタイトルで検索" %><br>
        <%= f.search_field :title_cont %>
        <%= f.submit "検索" %>
        <% end %>
      </div>
    </div>
    <div class="col"></div>
  </div>
  <div class="row">
    <div class="col-md-12 mx-auto">
      <table class="table table-responsive text-break table-hover">
        <thead>
          <tr>
            <th></th>
            <th>ランキング</th>
            <!--<th class="text-center">いいね</th>-->
            <th class="text-center">コメント数</th>
            <th class="text-center">日付</th>
            <th></th>
          </tr>
        </thead>
        <% @rankings.each do |ranking| %>
          <tr>
            <td><!--このランキングの最初のアイテムの画像-->
              <% @image = ranking.items.first%>
              <%= link_to ranking_path(ranking) do %>
                <%= attachment_image_tag(@image, :image, :fill, 100, 100, fallback: "no_image.jpg",size:"100x100") %>
              <% end %>
            </td>
            <td class="align-middle h3" style="height:100px; width:33%;"><%= link_to ranking.title.truncate(30), ranking_path(ranking), class: "text-dark"%></td><!--ランキングタイトル(15文字まで表示)-->
            <td class="text-center align-middle" style="width:33%;"><!--コメント数-->
              <% @comments_count = 0 %>
              <% ranking.items.each do |item| %>
                <% @comments_count = @comments_count + item.comments.count %>
              <% end %>
              <%= @comments_count %>
            </td>
            <td class="text-center align-middle" style="width:33%;"><%= ranking.created_at.strftime('%Y/%m/%d') %></td><!--投稿日時-->
          </tr>
          <tr style="height:40px;">
            <td class="text-right pt-0"><span class="pt-2 align-middle"style="width:50px;">タグ：</span></td><!--タグ-->
            
            <td class="d-flex align-middle text-truncate pt-0"><!--タグ-->
              <% ranking.tag_list.first(3).each do |tag| %>
                <span class="btn btn-primary mr-1 d-block text-truncate"><%= link_to tag,rankings_path(tag_name: tag),class: "text-white"%></span>
              <% end %>
              <% if ranking.tag_list.count >= 3 %>
              <td>
                <div class="panel-group">
                  <div class="panel panel-default">
                    <div class="panel-heading">
                      <h4 class="panel-title">
                        <a data-toggle="collapse" href="#collapse<%= ranking.id %>">全てのタグ</a>
                      </h4>
                    </div>
                    <div id="collapse<%= ranking.id %>" class="panel-collapse collapse">
                      <div class="panel-body">
                        <% ranking.tag_list.each do |tag| %>
                          <span class="btn btn-primary text-truncate mb-1"><%= link_to tag,rankings_path(tag_name: tag),class: "text-white"%></span>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
              <% else %>
                <td></td>
              <% end %>
            </td>
            
            
            <% if ranking.user == current_user %>
              <td class="text-right" style="width:33%">
                <%= link_to "削除",ranking_path(ranking), method: :delete, class:"btn btn-danger btn-sm"%>
              </td>
            <% end %>
          </tr>
        <% end %>
      </table>
    </div>
  </div>
</div>

<div class="panel-group">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" href="#collapse1">click me</a>
      </h4>
    </div>
    <div id="collapse1" class="panel-collapse collapse">
      <div class="panel-body">内容</div>
      <div class="panel-footer">フッター</div>
    </div>
  </div>
</div>

<div class="panel-group">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" href="#collapse2">click me</a>
      </h4>
    </div>
    <div id="collapse2" class="panel-collapse collapse">
      <ul class="list-group">
        <li class="list-group-item">One</li>
        <li class="list-group-item">Two</li>
        <li class="list-group-item">Three</li>
      </ul>
      <div class="panel-footer">フッター</div>
    </div>
  </div>
</div>